# Day 7 – Secure Remote Access & Overlay Networking (Tailscale)

**Date:** 2026-01-11  
**Primary Server:** thinkpad (Ubuntu / Liquorix kernel)  
**Client:** arch-predator (Arch Linux)

---

## Objective

Ensure the homelab server is reachable **securely and reliably** in *all realistic conditions*:

- Server may be on LAN / hotspot / offline internet
- Client device always has internet
- No dependence on desktop environment
- No exposed public SSH
- Zero guesswork in networking and firewall behavior

---

## Final Architecture (Achieved)

- **Local access:** SSH over LAN (when available)
- **Remote access:** SSH over Tailscale (always)
- **Security model:** Default-deny firewall + explicit trust
- **Overlay network:** Tailscale with subnet routing
- **No display / DE changes**

---

## Work Done

### 1. SSH Hardening & Validation

- SSH key-based auth confirmed
- `sshd_config` validated with:
  ```bash
  sudo sshd -t
````

* SSH bound to all interfaces, firewall-controlled
* Confirmed listening state:

  ```bash
  ss -tulpn | grep :22
  ```

Result: **Stable SSH service**, no crashes, predictable behavior.

---

### 2. Firewall (UFW) Cleanup – Critical Fix

**Problem identified:**
Overly broad LAN allow rules interfered with Tailscale routing and SSH reliability.

**Fix applied:**

```bash
sudo ufw delete allow from 10.70.133.0/24
sudo ufw delete allow from 192.168.1.0/24
sudo ufw reload
```

**Final effective rules:**

* SSH allowed explicitly
* Tailscale interface trusted
* No blanket LAN trust
* Default incoming: DENY

Verification:

```bash
sudo ufw status verbose
```

Result: **SSH works everywhere, breaks nowhere.**

---

### 3. Tailscale Installation & Auth (Both Machines)

#### Server (thinkpad – Ubuntu)

```bash
sudo apt install tailscale
sudo systemctl enable --now tailscaled
sudo tailscale up
```

#### Client (arch-predator – Arch)

```bash
sudo pacman -S tailscale
sudo systemctl enable --now tailscaled
sudo tailscale up
```

Verified connectivity:

```bash
tailscale status
```

---

### 4. Subnet Routing (Server)

Advertised LANs:

```bash
sudo tailscale up --advertise-routes=192.168.1.0/24,10.70.133.0/24
```

Enabled forwarding:

```bash
sudo nano /etc/sysctl.d/99-tailscale.conf
```

```conf
net.ipv4.ip_forward=1
net.ipv6.conf.all.forwarding=1
```

Applied:

```bash
sudo sysctl --system
```

Routes visible in Tailscale admin panel and approved.

---

### 5. Final Connectivity Test (Success)

From **any network** (LAN / hotspot / college Wi-Fi):

```bash
ssh arjun@thinkpad
```

and

```bash
ssh arjun@100.116.193.118
```

✅ Works consistently
❌ No public exposure
❌ No dependency on LAN availability

---

## Monitoring & Health Checks Added

Installed:

```bash
sudo apt install htop iotop iftop sysstat
sudo systemctl enable --now sysstat
```

Verified:

* `sar -u`
* `smartctl -a /dev/sda`
* `smartctl -a /dev/sdb`

Disk health: **PASSED**
CPU idle: **~99%**

---

## Outcome

* Server access is **deterministic**
* Network behavior is **understood**
* Firewall rules are **minimal and intentional**
* Remote access works even if the server’s LAN has no internet
* System no longer “guesses” what it’s doing

---

## Notes

* No display manager or desktop environment touched
* No services exposed to public internet
* System is now in a **stable baseline state**

**Day 7 complete.**

```

